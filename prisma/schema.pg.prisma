generator client {
    provider = "prisma-client-js"
    output   = "../node_modules/@prisma/pg"
}

datasource db {
    provider = "postgresql"
    url      = env("PG_URL")
}

model User {
    id String @id @default(uuid())

    email      String   @unique
    password   String
    role       Role
    createTime DateTime @default(now())

    profile Profile?

    friendsOf Friend[] @relation("FriendOfUser")
    friends   Friend[] @relation("UserFriends")

    follows  Follow[] @relation("UserFollows")
    followed Follow[] @relation("UserFollowed")

   
}

model Profile {
    user       User       @relation(fields: [userId], references: [id], onUpdate: Cascade)
    userId     String     @id

    fullname       String? // this one can be changed anytime
    username   String     @unique // limited chance to modify
    avatar     String?
    bio        String?
    interests  Interest[]
    
    tags  String[]

    location   String?
    external_link String?


   


    gender     String?
    birthday   DateTime?
    createTime DateTime   @default(now())
    updateTime DateTime   @updatedAt
}

model Friend {
    id_from String
    id_to   String
    user1   User   @relation(name: "FriendOfUser", fields: [id_from], references: [id], onUpdate: Cascade)
    user2   User   @relation(name: "UserFriends", fields: [id_to], references: [id], onUpdate: Cascade)

    @@id([id_from, id_to])
    @@unique([id_from, id_to])
}

model Follow {
    id_from String
    id_to   String
    user_follows   User   @relation(name: "UserFollows", fields: [id_from], references: [id], onUpdate: Cascade)
    user_followed   User   @relation(name: "UserFollowed", fields: [id_to], references: [id], onUpdate: Cascade)

    @@id([id_from, id_to])
    @@unique([id_from, id_to])
}



enum Role {
    COMMON
    ADMIN
    DISABLED
}

enum Interest {
    SPORT
    MUSIC
    MOVIE
    TRAVEL
    FOOD
    GAME
    TECH
    ART
    SCIENCE
    LITERATURE
    OTHER
}

