generator client {
    provider = "prisma-client-js"
    output   = "../node_modules/@prisma/pg"
}

datasource db {
    provider = "postgresql"
    url      = env("PG_URL")
}

model User {
    id String @id @default(uuid())

    email      String   @unique
    password   String
    role       Role
    createTime DateTime @default(now())

    profile Profile?

    friendsOf Friend[] @relation("FriendOfUser")
    friends   Friend[] @relation("UserFriends")

    follows  Follow[] @relation("UserFollows")
    followed Follow[] @relation("UserFollowed")

   
}

model Profile {
    user       User       @relation(fields: [userId], references: [id], onUpdate: Cascade)
    userId     String     @id
    name       String?
    customId   String     @unique
    avatar     String?
    bio        String?
    interests  Interest[]
    gender     String?
    createTime DateTime   @default(now())
    updateTime DateTime   @updatedAt
}

model Friend {
    id_from String
    id_to   String
    user1   User   @relation(name: "FriendOfUser", fields: [id_from], references: [id], onUpdate: Cascade)
    user2   User   @relation(name: "UserFriends", fields: [id_to], references: [id], onUpdate: Cascade)

    @@id([id_from, id_to])
    @@unique([id_from, id_to])
}

model Follow {
    id_from String
    id_to   String
    user1   User   @relation(name: "UserFollows", fields: [id_from], references: [id], onUpdate: Cascade)
    user2   User   @relation(name: "UserFollowed", fields: [id_to], references: [id], onUpdate: Cascade)

    @@id([id_from, id_to])
    @@unique([id_from, id_to])
}

// model Post {
//     id       String @id @default(uuid())
//     title    String
//     author   User   @relation(name: "originPosts", fields: [authorId], references: [id])
//     authorId String

//     poster   User   @relation(name: "forwardedPosts", fields: [posterId], references: [id])
//     posterId String
// }

enum Role {
    COMMON
    ADMIN
    DISABLED
}

enum Interest {
    SPORT
    MUSIC
    MOVIE
    TRAVEL
    FOOD
    GAME
    TECH
    ART
    SCIENCE
    LITERATURE
    OTHER
}


