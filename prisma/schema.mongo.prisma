// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

datasource db {
    provider = "mongodb"
    url      = env("Mongo_URL")
}

generator client {
    provider = "prisma-client-js"
    output   = "../node_modules/@prisma/mongo"
}

model User {
    id String @id @map("_id") @db.String

    posts_ Post[] @relation("posts")

    posts  String[]

    LikeTable LikeTable[]

    notificationCenter NotificationCenter?
}

model Post {
    id String @id @default(auto()) @map("_id") @db.ObjectId


    title String?

    content String?

    media String[]

    status PostStatus @default(DRAFT)

    author   User   @relation(name: "posts", fields: [authorId], references: [id])
    authorId String @db.String

    createTime DateTime @default(now())
    updateTime DateTime @updatedAt

    replyParentId String? @db.ObjectId
    replyParent   Post?   @relation("replyTo", fields: [replyParentId], references: [id], onUpdate: NoAction, onDelete: NoAction)

    replies_ Post[]   @relation("replyTo")
    replies  String[]

    repostParentId String? @db.ObjectId
    repostParent Post?       @relation("repostTo", fields: [repostParentId], references: [id], onUpdate: NoAction, onDelete: NoAction)
    
    reposts_     Post[]      @relation("repostTo")
    reposts      String[]

    likes        LikeTable[]
}

model LikeTable {
    id String @id @default(auto()) @map("_id") @db.ObjectId

    post   Post   @relation(fields: [postId], references: [id])
    postId String @db.ObjectId

    user   User   @relation(fields: [userId], references: [id])
    userId String @db.String

    @@unique([postId, userId])
}

model NotificationCenter {
    user   User   @relation(fields: [userId], references: [id])
    userId String @id @map("_id") @db.String

    notifications Notification[]
}

type Notification {
    type       NotificationType
    content    String
    sender     String
    createTime DateTime         @default(now())
    read       Boolean          @default(false)
}

enum NotificationType {
    LIKE
    REPLY
    FOLLOW
}

enum PostStatus {
    DRAFT
    UNDER_REVIEW
    PUBLISHED
    HIDDEN
}
