
  <!DOCTYPE html>
  <html>
    <head>
      <title>profile.service.spec.ts</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="..\..\..\..\assets\source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="..\..\..\..\assets\source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="..\..\..\..\index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="positive"><td class="">src\byan\profile\profile.service.spec.ts</td><td class="">95.90%</td><td class="">80%</td><td class="">244</td><td class="">234</td><td class="">10</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">import { Test, TestingModule } from &#x27;@nestjs/testing&#x27;;
import { ProfileService } from &#x27;./profile.service&#x27;;
import { DbUserService } from &#x27;../../xueshen/db/user/db_user.service&#x27;;
import { User, Profile } from &quot;@prisma/pg&quot;;
import UpdateProfileDto from &#x27;src/xueshen/dto/updateProfileDto&#x27;;

describe(&#x27;ProfileService&#x27;, () =&gt; {
  let service: ProfileService;
  let fakeDbUserService: Partial&lt;DbUserService&gt;;

  beforeEach(async () =&gt; {
    // Create a fake copy of the DbUserService
    const userProfiles: Profile[] = [];
    const users: User[] = [];

    const profile1 = {
      userId : &quot;1a&quot;,
      username: &quot;Amy&quot;,
      fullname: &#x27;Amy Green&#x27;,
      avatar: &#x27;1.jpg&#x27;,
      bio: &#x27;power girl&#x27;
    } as Profile;

    const profile2 = {
      userId : &quot;2b&quot;,
      username: &quot;Bobby&quot;,
      fullname: &#x27;Bobby White&#x27;,
      avatar: &#x27;2.jpg&#x27;,
      bio: &#x27;super man&#x27;
    } as Profile;

    const profile3 = {
      userId : &quot;3c&quot;,
      username: &quot;Cindy&quot;,
      fullname: &#x27;Cindy Black&#x27;,
      avatar: &#x27;3.jpg&#x27;,
      bio: &#x27;shero&#x27;
    } as Profile;

    userProfiles.push(profile1);
    userProfiles.push(profile2);
    userProfiles.push(profile3);

    const user1 = {
      id : &quot;u1&quot;,
      email: &quot;u1@gmail.com&quot;,
      password: &quot;u1u1&quot;
    } as User;

    const user2 = {
      id : &quot;u2&quot;,
      email: &quot;u2@gmail.com&quot;,
      password: &quot;u2u2&quot;
    } as User;

    const user3 = {
      id : &quot;u3&quot;,
      email: &quot;u3@gmail.com&quot;,
      password: &quot;u3u3&quot;
    } as User;

    users.push(user1);
    users.push(user2);
    users.push(user3);

    fakeDbUserService = {
      query_profile_by_user_id: (userId: string): Promise&lt;Profile | null&gt; =&gt;  {
        const filteredUserProfile = userProfiles.filter((profile) =&gt; profile.userId === userId);
        if (!filteredUserProfile) {
          return Promise.resolve(null);
        } else {
          return Promise.resolve(filteredUserProfile[0]);
        }
      },
      updateProfile: (updateProfileDto: UpdateProfileDto): Promise&lt;false&gt; =&gt; {
        return Promise.resolve(false);
      },
      query_user_by_email: (email: string): Promise&lt;User | null&gt; =&gt; {
        const filteredUser = users.filter((user) =&gt; user.email === email);
        if (!filteredUser) {
          return Promise.resolve(null);
        } else {
          return Promise.resolve(filteredUser[0]);
        }
      }
    };

    const module: TestingModule = await Test.createTestingModule({
      providers: [
        ProfileService,
        {
          provide: DbUserService,
          useValue: fakeDbUserService,
        },
        
      ],
    }).compile();

    service = module.get&lt;ProfileService&gt;(ProfileService);
  });

  it(&#x27;should be defined&#x27;, async () =&gt; {
    expect(service).toBeDefined();
  });

  it(&#x27;return corresponding profile if an existing userId given&#x27;, async () =&gt; {
    const profile = await service.getProfileByUserId(&#x27;1a&#x27;);
    expect(service).toBeDefined();
    expect(profile.userId).toEqual(&#x27;1a&#x27;);
  });

  it(&#x27;return undefined if an non-existing userId given&#x27;, async () =&gt; {
    const profile = await service.getProfileByUserId(&#x27;ww&#x27;);
    expect(service).toBeDefined();
    expect(profile).toEqual(undefined);
  });

  it(&#x27;update the profile for the given user&#x27;, async () =&gt; {
    const userProfilesNew: Profile[] = [];

    const profile1New = {
      userId : &quot;1a&quot;,
      username: &quot;Amy&quot;,
      fullname: &#x27;Amy Green&#x27;,
      avatar: &#x27;1.jpg&#x27;,
      bio: &#x27;power girl&#x27;
    } as Profile;

    const profile2New = {
      userId : &quot;2b&quot;,
      username: &quot;Bobby&quot;,
      fullname: &#x27;Bobby White&#x27;,
      avatar: &#x27;2.jpg&#x27;,
      bio: &#x27;super man&#x27;
    } as Profile;

    const profile3New = {
      userId : &quot;3c&quot;,
      username: &quot;Cindy&quot;,
      fullname: &#x27;Cindy Black&#x27;,
      avatar: &#x27;3.jpg&#x27;,
      bio: &#x27;shero&#x27;
    } as Profile;

    userProfilesNew.push(profile1New);
    userProfilesNew.push(profile2New);
    userProfilesNew.push(profile3New);

    fakeDbUserService.updateProfile = (updateProfileDto: UpdateProfileDto) =&gt;  {
        // const profile3Updated = {
        //   userId : &quot;3c&quot;,
        //   username: &quot;Cindy&quot;,
        //   fullname: &#x27;Cindy Black&#x27;,
        //   avatar: &#x27;3updated.jpg&#x27;,
        //   bio: &#x27;shero Updated&#x27;
        // } as Profile;
        userProfilesNew[2].avatar = &#x27;3updated.jpg&#x27;;
        userProfilesNew[2].bio = &#x27;shero Updated&#x27;;
        return Promise.resolve(false)
      };

    const userProfileUpdated = await service.updateProfile({
      userId: &#x27;3c&#x27;,
      fullname: &#x27;Cindy Black&#x27;,
      avatar: &#x27;3updated.jpg&#x27;,
      bio: &#x27;shero Updated&#x27;,
      interests: [],
      tags: [],
      gender: &#x27;&#x27;,
      getNoneEmptyData: () =&gt; {
        throw new Error(&#x27;Function not implemented.&#x27;);
      }} as UpdateProfileDto);
    expect(userProfilesNew[2].avatar).toEqual(&#x27;3updated.jpg&#x27;);
    expect(userProfilesNew[2].bio).toEqual(&#x27;shero Updated&#x27;);
    expect(userProfileUpdated).toEqual(false);
  });

  it(&#x27;return corresponding user if an existing email given&#x27;, async () =&gt; {
    const returnedUser = await service.getUserByEmail(&#x27;u1@gmail.com&#x27;);
    expect(service).toBeDefined();
    expect(returnedUser.id).toEqual(&#x27;u1&#x27;);
  });

  it(&#x27;return undefined if an non-existing email given&#x27;, async () =&gt; {
    const returnedUser = await service.getUserByEmail(&#x27;upp@gmail.com&#x27;);
    expect(service).toBeDefined();
    expect(returnedUser).toEqual(undefined);
  });
});
</textarea><pre id="annotations" style="display:none">[{&quot;file&quot;:&quot;src\\byan\\profile\\profile.service.spec.ts&quot;,&quot;line&quot;:106,&quot;character&quot;:10,&quot;text&quot;:&quot;profile&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src\\byan\\profile\\profile.service.spec.ts&quot;,&quot;line&quot;:108,&quot;character&quot;:11,&quot;text&quot;:&quot;profile&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src\\byan\\profile\\profile.service.spec.ts&quot;,&quot;line&quot;:108,&quot;character&quot;:19,&quot;text&quot;:&quot;userId&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src\\byan\\profile\\profile.service.spec.ts&quot;,&quot;line&quot;:112,&quot;character&quot;:10,&quot;text&quot;:&quot;profile&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src\\byan\\profile\\profile.service.spec.ts&quot;,&quot;line&quot;:114,&quot;character&quot;:11,&quot;text&quot;:&quot;profile&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src\\byan\\profile\\profile.service.spec.ts&quot;,&quot;line&quot;:178,&quot;character&quot;:10,&quot;text&quot;:&quot;returnedUser&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src\\byan\\profile\\profile.service.spec.ts&quot;,&quot;line&quot;:180,&quot;character&quot;:11,&quot;text&quot;:&quot;returnedUser&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src\\byan\\profile\\profile.service.spec.ts&quot;,&quot;line&quot;:180,&quot;character&quot;:24,&quot;text&quot;:&quot;id&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src\\byan\\profile\\profile.service.spec.ts&quot;,&quot;line&quot;:184,&quot;character&quot;:10,&quot;text&quot;:&quot;returnedUser&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;src\\byan\\profile\\profile.service.spec.ts&quot;,&quot;line&quot;:186,&quot;character&quot;:11,&quot;text&quot;:&quot;returnedUser&quot;,&quot;kind&quot;:1}]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Thu, 04 Apr 2024 16:26:48 GMT</p>
    </body>
  </html>
  